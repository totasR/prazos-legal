<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Calculadora de Prazos Processuais</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; padding: 0 1em; }
    label { display: block; margin: .5em 0; }
    input, select, button { padding: .4em; font-size: 1em; }
    button { margin-top: 1em; }
    #result { margin-top: 1.5em; padding: 1em; background: #f0f0f0; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>üìÖ Calculadora de Prazos Processuais</h1>

  <label>Processo:
    <select id="proc">
      <option value="Civil">Civil</option>
      <option value="Penal">Penal</option>
      <option value="Administrativo">Administrativo</option>
    </select>
  </label>

  <label>Tipo de Ato:
    <select id="ato">
      <option value="Notifica√ß√£o">Notifica√ß√£o</option>
      <option value="Cita√ß√£o">Cita√ß√£o</option>
    </select>
  </label>

  <label>Notifica√ß√£o:
    <select id="notif">
      <option>Eletr√≥nica</option>
      <option>Carta AR</option>
      <option>Mandat√°rio</option>
      <option>Presencial</option>
    </select>
  </label>

  <label>Data da notifica√ß√£o:
    <input type="date" id="date_notif" value="">
  </label>

  <label id="dil_label" class="hidden">Dila√ß√µes (dias):
    <input type="number" id="dil" min="0" value="0">
  </label>

  <label><input type="checkbox" id="urg"> Urgente</label>
  <label><input type="checkbox" id="sus" checked> Suspende em f√©rias judiciais</label>

  <label>Prazo (dias):
    <input type="number" id="prazo" min="1" value="10">
  </label>

  <button id="calc">Calcular</button>

  <div id="result"></div>

  <script>
    // Lista de feriados nacionais em Portugal 2025
    const holidays = [
      "2025-01-01", "2025-04-18", "2025-04-20", "2025-04-25", "2025-05-01",
      "2025-06-10", "2025-06-19", "2025-08-15", "2025-10-05",
      "2025-11-01", "2025-12-01", "2025-12-08", "2025-12-25"
    ];

    function isBusinessDay(d) {
      const wd = d.getDay();
      const iso = d.toISOString().slice(0,10);
      return wd >=1 && wd <=5 && !holidays.includes(iso);
    }

    function addDays(d, n) {
      const x = new Date(d);
      x.setDate(x.getDate() + n);
      return x;
    }

    function getEffectiveDate(nd, type) {
      let eff = new Date(nd);
      if (type === "Carta AR") eff = addDays(eff, 10);
      else if (type === "Mandat√°rio") eff = addDays(eff, 5);
      // Eletr√≥nica e Presencial = dia mesmo

      // avan√ßa at√© ser dia √∫til
      while (!isBusinessDay(eff)) {
        eff = addDays(eff, 1);
      }
      return eff;
    }

    function calculateDeadline(eff, dil, prazo) {
      // in√≠cio: pr√≥ximo dia √∫til
      let start = addDays(eff, 1);
      while (!isBusinessDay(start)) start = addDays(start,1);

      // aplica dila√ß√£o (dias √∫teis)
      let cnt=0;
      while (cnt < dil) {
        start = addDays(start,1);
        if (isBusinessDay(start)) cnt++;
      }

      // conta o prazo (dias √∫teis)
      let cnt2 = 0;
      let end = new Date(start);
      while (cnt2 < prazo) {
        end = addDays(end,1);
        if (isBusinessDay(end)) cnt2++;
      }

      return { eff, start, end };
    }

    function updateDilField() {
      const proc = document.getElementById("proc").value;
      const ato = document.getElementById("ato").value;
      const dilLabel = document.getElementById("dil_label");
      // S√≥ mostra se Processo Civil E Ato Cita√ß√£o
      if (proc === "Civil" && ato === "Cita√ß√£o") {
        dilLabel.classList.remove("hidden");
      } else {
        dilLabel.classList.add("hidden");
        document.getElementById("dil").value = 0;
      }
    }

    document.getElementById("proc").onchange = updateDilField;
    document.getElementById("ato").onchange = updateDilField;

    document.getElementById("calc").onclick = () => {
      const nd = document.getElementById("date_notif").value;
      if (!nd) { alert("Escolhe uma data!"); return; }
      const notif = document.getElementById("notif").value;
      const proc = document.getElementById("proc").value;
      const ato = document.getElementById("ato").value;
      let dil = 0;
      // S√≥ considera dila√ß√£o se Processo Civil e Cita√ß√£o
      if (proc === "Civil" && ato === "Cita√ß√£o") {
        dil = parseInt(document.getElementById("dil").value) || 0;
      }
      const prazo = parseInt(document.getElementById("prazo").value);

      const eff = getEffectiveDate(nd, notif);
      const { start, end } = calculateDeadline(eff, dil, prazo);

      const fmt = d => d.toLocaleDateString("pt-PT");
      document.getElementById("result").innerHTML = `
        <p>üîî <strong>Data efetiva da notifica√ß√£o:</strong> ${fmt(eff)}</p>
        <p>üü¢ <strong>Data in√≠cio da contagem:</strong> ${fmt(start)}</p>
        <p>‚è∞ <strong>Data final (prazo):</strong> ${fmt(end)}</p>
        <p style="font-size:0.9em;color:#666;">
          ${proc === "Civil" && ato === "Cita√ß√£o" && dil > 0 ? "Dila√ß√£o aplicada conforme art. 245.¬∫ CPC." : ""}
          ${proc === "Civil" && ato === "Notifica√ß√£o" ? "Sem dila√ß√£o em notifica√ß√µes civis (art. 245.¬∫ CPC)." : ""}
        </p>
      `;
    };

    // inicializa data hoje no datepicker
    document.getElementById("date_notif").value = new Date().toISOString().slice(0,10);

    // inicializa campo dila√ß√£o vis√≠vel/escondido
    updateDilField();
  </script>
</body>
</html>
